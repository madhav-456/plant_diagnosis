<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fertilizer Recommendation | AgroTech</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Font -->
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: #f8fafc;
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.4);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>

<body>

<!-- NAVBAR -->
<nav class="bg-white shadow-md fixed w-full z-10">
    <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
        <h1 class="text-2xl font-bold text-gray-800 flex items-center">
            <i class="fas fa-leaf text-green-500 mr-2"></i> Agro<span class="text-green-500">Tech</span>
        </h1>

        <div class="hidden md:flex space-x-6">
            <a href="/" class="text-gray-600 hover:text-green-500">Home</a>
            <a href="#" class="text-green-500 font-semibold">Fertilizer</a>
            <a href="#" class="text-gray-600 hover:text-green-500">Crop</a>
            <a href="#" class="text-gray-600 hover:text-green-500">Disease</a>
            <a href="#" class="text-gray-600 hover:text-green-500">Assistant</a>
        </div>
    </div>
</nav>

<!-- MAIN CONTENT -->
<section class="pt-28 pb-16 px-6">
    <div class="max-w-4xl mx-auto">

        <!-- HEADER CARD -->
        <div class="bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-2xl p-10 shadow-xl mb-10">
            <h1 class="text-4xl font-bold mb-3">Fertilizer Recommendation</h1>
            <p class="text-lg opacity-90">AI-powered fertilizer advice based on soil & weather data.</p>
        </div>

        <!-- FORM -->
        <form id="fertilizerForm" class="bg-white p-8 rounded-2xl shadow-lg">

            <h2 class="text-xl font-semibold mb-6">
                <i class="fas fa-flask text-green-500 mr-2"></i>
                Enter Soil & Environmental Values
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                <div>
                    <label class="font-medium">Temperature (°C)</label>
                    <input id="temperature" type="number" required 
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-400">
                </div>

                <div>
                    <label class="font-medium">Humidity (%)</label>
                    <input id="humidity" type="number" required 
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-400">
                </div>

                <div>
                    <label class="font-medium">Moisture</label>
                    <input id="moisture" type="number" required 
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400">
                </div>

                <div>
                    <label class="font-medium">Nitrogen (N)</label>
                    <input id="nitrogen" type="number" required 
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400">
                </div>

                <div>
                    <label class="font-medium">Phosphorous (P)</label>
                    <input id="phosphorous" type="number" required 
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400">
                </div>

                <div>
                    <label class="font-medium">Potassium (K)</label>
                    <input id="potassium" type="number" required 
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400">
                </div>

                <div>
                    <label class="font-medium">Soil Type</label>
                    <select id="soil" required class="w-full px-4 py-2 border rounded-lg">
                        <option>Select…</option>
                        <option>Black</option>
                        <option>Clayey</option>
                        <option>Loamy</option>
                        <option>Red</option>
                        <option>Sandy</option>
                    </select>
                </div>

                <div>
                    <label class="font-medium">Crop Type</label>
                    <select id="crop" required class="w-full px-4 py-2 border rounded-lg">
                        <option>Select…</option>
                        <option>Rice</option>
                        <option>Maize</option>
                        <option>Wheat</option>
                        <option>Cotton</option>
                        <option>Sugarcane</option>
                        <option>Coffee</option>
                        <option>Pomegranate</option>
                        <option>Millets</option>
                    </select>
                </div>

            </div>

            <div class="text-center mt-8">
                <button id="submitBtn" type="submit"
                    class="bg-green-500 hover:bg-green-600 text-white px-10 py-3 rounded-lg font-medium shadow-md transition">
                    <i class="fas fa-leaf mr-2"></i> Get Recommendation
                </button>
            </div>
        </form>

        <!-- RESULT BOX -->
        <div id="resultBox" class="hidden mt-10 bg-blue-50 p-6 rounded-2xl shadow">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">
                <i class="fas fa-check-circle text-green-500 mr-2"></i>
                Recommended Fertilizer
            </h2>
            <p id="resultText" class="text-gray-700 text-lg"></p>
        </div>
    </div>
</section>

<script>
// FORM SUBMISSION
document.getElementById("fertilizerForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const btn = document.getElementById("submitBtn");
    btn.disabled = true;
    btn.innerHTML = `<div class="loading-spinner inline-block"></div> Processing...`;

    const payload = {
        temperature: parseFloat(document.getElementById("temperature").value),
        humidity: parseFloat(document.getElementById("humidity").value),
        moisture: parseFloat(document.getElementById("moisture").value),
        nitrogen: parseFloat(document.getElementById("nitrogen").value),
        phosphorous: parseFloat(document.getElementById("phosphorous").value),
        potassium: parseFloat(document.getElementById("potassium").value),
        soil: document.getElementById("soil").value,
        crop: document.getElementById("crop").value
    };

    try {
        const res = await fetch("/api/fertilizer_advice", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        const data = await res.json();

        document.getElementById("resultText").innerHTML =
            `<strong>${data.recommendation}</strong>`;

        document.getElementById("resultBox").classList.remove("hidden");

    } catch (err) {
        document.getElementById("resultText").innerHTML =
            `<span class="text-red-600">Error: ${err.message}</span>`;
        document.getElementById("resultBox").classList.remove("hidden");
    }

    btn.disabled = false;
    btn.innerHTML = `<i class="fas fa-leaf mr-2"></i> Get Recommendation`;
});
</script>

</body>
</html>
